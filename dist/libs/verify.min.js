"use strict";!function(r,a,e){function s(t,i){this.$element=t,this.defaults={type:1,figure:100,arith:0,width:"200px",height:"60px",fontSize:"30px",codeLength:6,btnId:"check-btn",ready:function(){},success:function(){},error:function(){}},this.options=r.extend({},this.defaults,i)}var c=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],l=["#fffff0","#f0ffff","#f0fff0","#fff0f0"],f=["#FF0033","#006699","#993366","#FF9900","#66CC66","#FF33CC"];s.prototype={init:function(){var t=this;this.loadDom(),this.setCode(),this.options.ready(),this.$element[0].onselectstart=e.body.ondrag=function(){return!1},this.$element.find(".verify-code, .verify-change-code").on("click",function(){t.setCode()}),this.htmlDoms.code_btn.on("click",function(){t.checkCode()})},loadDom:function(){this.$element.append('<div class="cerify-code-panel"><div class="verify-code"></div><div class="verify-code-area"><div class="verify-input-area"><input type="text" class="varify-input-code" /></div><div class="verify-change-area"><a class="verify-change-code">换一张</a></div></div></div>'),this.isEnd=!1,this.htmlDoms={code_btn:r("#"+this.options.btnId),code:this.$element.find(".verify-code"),code_area:this.$element.find(".verify-code-area"),code_input:this.$element.find(".varify-input-code")},this.htmlDoms.code.css({width:this.options.width,height:this.options.height,"line-height":this.options.height,"font-size":this.options.fontSize}),this.htmlDoms.code_area.css({width:this.options.width})},setCode:function(){if(0==this.isEnd){var t=Math.floor(3*Math.random()),i=Math.floor(5*Math.random());this.htmlDoms.code.css({"background-color":l[t],color:f[i]}),this.htmlDoms.code_input.val("");var s="";if(this.code_chose="",1==this.options.type)for(var e=0;e<this.options.codeLength;e++){var o=Math.floor(52*Math.random()),h=o%2==0?"font-style:italic;margin-right: 10px;":"font-weight:bolder;";h+=1==Math.floor(2*Math.random())?"font-weight:bolder;":"",this.code_chose+=c[o],s+='<font style="'+h+'">'+c[o]+"</font>"}else{var n,r,a=Math.floor(Math.random()*this.options.figure),m=Math.floor(Math.random()*this.options.figure);switch(0==this.options.arith&&(n=Math.floor(3*Math.random())),n){case 1:this.code_chose=parseInt(a)+parseInt(m),s=a+" + "+m+" = ?";break;case 2:parseInt(a)<parseInt(m)&&(r=a,a=m,m=r),this.code_chose=parseInt(a)-parseInt(m),s=a+" - "+m+" = ?";break;default:this.code_chose=parseInt(a)*parseInt(m),s=a+" × "+m+" = ?"}}this.htmlDoms.code.html(s)}},checkCode:function(){var t;1==this.options.type?(t=this.htmlDoms.code_input.val().toUpperCase(),this.code_chose=this.code_chose.toUpperCase()):t=this.htmlDoms.code_input.val(),t==this.code_chose?(this.isEnd=!0,this.options.success(this)):(this.options.error(this),this.setCode())},refresh:function(){this.isEnd=!1,this.$element.find(".verify-code").click()}};function o(t,i){this.$element=t,this.defaults={type:1,mode:"fixed",vOffset:5,vSpace:5,explain:"向右滑动完成验证",imgUrl:"images/",imgName:["1.jpg","2.jpg"],imgSize:{width:"400px",height:"200px"},blockSize:{width:"50px",height:"50px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}},this.options=r.extend({},this.defaults,i)}o.prototype={init:function(){var i=this;this.loadDom(),this.options.ready(),this.$element[0].onselectstart=e.body.ondrag=function(){return!1},"pop"==this.options.mode&&(this.$element.on("mouseover",function(t){i.showImg()}),this.$element.on("mouseout",function(t){i.hideImg()}),this.htmlDoms.out_panel.on("mouseover",function(t){i.showImg()}),this.htmlDoms.out_panel.on("mouseout",function(t){i.hideImg()})),this.htmlDoms.move_block.on("touchstart",function(t){i.start(t)}),this.htmlDoms.move_block.on("mousedown",function(t){i.start(t)}),a.addEventListener("touchmove",function(t){i.move(t)}),a.addEventListener("mousemove",function(t){i.move(t)}),a.addEventListener("touchend",function(){i.end()}),a.addEventListener("mouseup",function(){i.end()}),i.$element.find(".verify-refresh").on("click",function(){i.refresh()})},loadDom:function(){this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var t="",i="";1!=this.options.type&&(t+='<div class="verify-img-out"><div class="verify-img-panel"><div  class="verify-refresh"><i class="iconfont icon-refresh"></i></div><div class="verify-gap"></div></div></div>',i='<div  class="verify-sub-block"></div>'),t+='<div class="verify-bar-area"><span  class="verify-msg">'+this.options.explain+'</span><div class="verify-left-bar"><span  class="verify-msg"></span><div  class="verify-move-block"><i  class="verify-icon iconfont icon-right"></i>'+i+"</div></div></div>",this.$element.append(t),this.htmlDoms={gap:this.$element.find(".verify-gap"),sub_block:this.$element.find(".verify-sub-block"),out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),move_block:this.$element.find(".verify-move-block"),left_bar:this.$element.find(".verify-left-bar"),msg:this.$element.find(".verify-msg"),icon:this.$element.find(".verify-icon"),refresh:this.$element.find(".verify-refresh")},this.status=!1,this.isEnd=!1,this.setSize=this.resetSize(this),this.$element.css("position","relative"),"pop"==this.options.mode?(this.htmlDoms.out_panel.css({display:"none",position:"absolute",bottom:"42px"}),this.htmlDoms.sub_block.css({display:"none"})):this.htmlDoms.out_panel.css({position:"relative"}),this.htmlDoms.gap.css({width:this.options.blockSize.width,height:this.options.blockSize.height}),this.htmlDoms.sub_block.css({width:this.options.blockSize.width,height:this.options.blockSize.height}),this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px"),this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,background:"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.htmlDoms.bar_area.css({width:this.setSize.bar_width,height:this.options.barSize.height,"line-height":this.options.barSize.height}),this.htmlDoms.move_block.css({width:this.options.barSize.height,height:this.options.barSize.height}),this.htmlDoms.left_bar.css({width:this.options.barSize.height,height:this.options.barSize.height}),this.randSet()},start:function(t){0==this.isEnd&&(this.htmlDoms.msg.text(""),this.htmlDoms.move_block.css("background-color","#337ab7"),this.htmlDoms.left_bar.css("border-color","#337AB7"),this.htmlDoms.icon.css("color","#fff"),t.stopPropagation(),this.status=!0)},move:function(t){var i;this.status&&0==this.isEnd&&("pop"==this.options.mode&&this.showImg(),i=(t.touches?t.touches[0].pageX:t.clientX)-o.prototype.getLeft(this.htmlDoms.bar_area[0]),1!=this.options.type?i>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2&&(i=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2):i>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3?(this.$element.find(".verify-msg:eq(1)").text("松开验证"),i=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3):this.$element.find(".verify-msg:eq(1)").text(""),i<=0&&(i=parseInt(parseInt(this.options.blockSize.width)/2)),this.htmlDoms.move_block.css("left",i-parseInt(parseInt(this.options.blockSize.width)/2)+"px"),this.htmlDoms.left_bar.css("width",i-parseInt(parseInt(this.options.blockSize.width)/2)+"px"))},end:function(){var t,i=this;this.status&&0==this.isEnd&&(1!=this.options.type?(t=parseInt(this.options.vOffset),parseInt(this.htmlDoms.gap.css("left"))>=parseInt(this.htmlDoms.move_block.css("left"))-t&&parseInt(this.htmlDoms.gap.css("left"))<=parseInt(this.htmlDoms.move_block.css("left"))+t?(this.htmlDoms.move_block.css("background-color","#5cb85c"),this.htmlDoms.left_bar.css({"border-color":"#5cb85c","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-check"),this.htmlDoms.refresh.hide(),this.isEnd=!0,this.options.success(this)):(this.htmlDoms.move_block.css("background-color","#d9534f"),this.htmlDoms.left_bar.css("border-color","#d9534f"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-close"),setTimeout(function(){i.refresh()},400),this.options.error(this))):parseInt(this.htmlDoms.move_block.css("left"))>=parseInt(this.setSize.bar_width)-parseInt(this.options.barSize.height)-parseInt(this.options.vOffset)?(this.htmlDoms.move_block.css("background-color","#5cb85c"),this.htmlDoms.left_bar.css({color:"#4cae4c","border-color":"#5cb85c","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-check"),this.htmlDoms.refresh.hide(),this.$element.find(".verify-msg:eq(1)").text("验证成功"),this.isEnd=!0,this.options.success(this)):(this.$element.find(".verify-msg:eq(1)").text(""),this.htmlDoms.move_block.css("background-color","#d9534f"),this.htmlDoms.left_bar.css("border-color","#d9534f"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-close"),this.isEnd=!0,setTimeout(function(){i.$element.find(".verify-msg:eq(1)").text(""),i.refresh(),i.isEnd=!1},400),this.options.error(this)),this.status=!1)},showImg:function(){this.htmlDoms.out_panel.css({display:"block"}),this.htmlDoms.sub_block.css({display:"block"})},hideImg:function(){this.htmlDoms.out_panel.css({display:"none"}),this.htmlDoms.sub_block.css({display:"none"})},resetSize:function(t){var i=t.$element.parent().width()||r(a).width(),s=t.$element.parent().height()||r(a).height(),e=-1!=t.options.imgSize.width.indexOf("%")?parseInt(t.options.imgSize.width)/100*i+"px":t.options.imgSize.width,o=-1!=t.options.imgSize.height.indexOf("%")?parseInt(t.options.imgSize.height)/100*s+"px":t.options.imgSize.height,h=-1!=t.options.barSize.width.indexOf("%")?parseInt(t.options.barSize.width)/100*i+"px":t.options.barSize.width,n=-1!=t.options.barSize.height.indexOf("%")?parseInt(t.options.barSize.height)/100*s+"px":t.options.barSize.height;return{img_width:e,img_height:o,bar_width:h,bar_height:n}},randSet:function(){var t=Math.floor(9*Math.random()+1),i=Math.floor(9*Math.random()+1),s=t*parseInt(this.setSize.img_height)/15+.1*parseInt(this.setSize.img_height),e=i*parseInt(this.setSize.img_width)/15+.1*parseInt(this.setSize.img_width);this.$element.find(".verify-gap").css({top:s,left:e}),this.$element.find(".verify-sub-block").css({top:"-"+(parseInt(this.setSize.img_height)-s+this.options.vSpace)+"px","background-image":"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height,"background-position-y":"-"+s+"px","background-position-x":"-"+e+"px"})},refresh:function(){this.htmlDoms.refresh.show(),this.$element.find(".verify-msg:eq(1)").text(""),this.$element.find(".verify-msg:eq(1)").css("color","#000"),this.htmlDoms.move_block.animate({left:"0px"},"fast"),this.htmlDoms.left_bar.animate({width:"40px"},"fast"),this.htmlDoms.left_bar.css({"border-color":"#ddd"}),this.htmlDoms.move_block.css("background-color","#fff"),this.htmlDoms.icon.css("color","#000"),this.htmlDoms.icon.removeClass("icon-close"),this.htmlDoms.icon.addClass("icon-right"),this.$element.find(".verify-msg:eq(0)").text(this.options.explain),this.randSet(),this.img_rand=Math.floor(Math.random()*this.options.imgName.length),this.$element.find(".verify-img-panel").css({background:"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.$element.find(".verify-sub-block").css({"background-image":"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.isEnd=!1},getLeft:function(t){return r(t).offset().left}};function h(t,i){this.$element=t,this.defaults={mode:"fixed",defaultNum:4,checkNum:3,vSpace:5,imgUrl:"images/",imgName:["1.jpg","2.jpg"],imgSize:{width:"400px",height:"200px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}},this.options=r.extend({},this.defaults,i)}h.prototype={init:function(){var i=this;i.loadDom(),i.refresh(),i.options.ready(),this.$element[0].onselectstart=e.body.ondrag=function(){return!1},"pop"==this.options.mode&&(this.$element.on("mouseover",function(t){i.showImg()}),this.$element.on("mouseout",function(t){i.hideImg()}),this.htmlDoms.out_panel.on("mouseover",function(t){i.showImg()}),this.htmlDoms.out_panel.on("mouseout",function(t){i.hideImg()})),i.$element.find(".verify-img-panel canvas").on("click",function(t){i.checkPosArr.push(i.getMousePos(this,t)),i.num==i.options.checkNum&&(i.num=i.createPoint(i.getMousePos(this,t)),setTimeout(function(){0==i.comparePos(i.fontPos,i.checkPosArr)?(i.options.error(i),i.$element.find(".verify-bar-area").css({color:"#d9534f","border-color":"#d9534f"}),i.$element.find(".verify-msg").text("验证失败"),setTimeout(function(){i.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"}),i.refresh()},400)):(i.$element.find(".verify-bar-area").css({color:"#4cae4c","border-color":"#5cb85c"}),i.$element.find(".verify-msg").text("验证成功"),i.$element.find(".verify-refresh").hide(),i.$element.find(".verify-img-panel").unbind("click"),i.options.success(i))},400)),i.num<i.options.checkNum&&(i.num=i.createPoint(i.getMousePos(this,t)))}),i.$element.find(".verify-refresh").on("click",function(){i.refresh()})},loadDom:function(){this.fontPos=[],this.checkPosArr=[],this.num=1,this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var t="";this.setSize=o.prototype.resetSize(this),t+='<div class="verify-img-out"><div class="verify-img-panel"><div class="verify-refresh" style="z-index:3"><i class="iconfont icon-refresh"></i></div><canvas width="'+this.setSize.img_width+'" height="'+this.setSize.img_height+'"></canvas></div></div><div class="verify-bar-area"><span  class="verify-msg"></span></div>',this.$element.append(t),this.htmlDoms={out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),msg:this.$element.find(".verify-msg")},this.$element.css("position","relative"),"pop"==this.options.mode?this.htmlDoms.out_panel.css({display:"none",position:"absolute",bottom:"42px"}):this.htmlDoms.out_panel.css({position:"relative"}),this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px"),this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,"background-size":this.setSize.img_width+" "+this.setSize.img_height,"margin-bottom":this.options.vSpace+"px"}),this.htmlDoms.bar_area.css({width:this.options.barSize.width,height:this.options.barSize.height,"line-height":this.options.barSize.height})},drawImg:function(t,i){var s=this.$element.find("canvas")[0].getContext("2d");s.drawImage(i,0,0,parseInt(this.setSize.img_width),parseInt(this.setSize.img_height));for(var e,o,h=["italic small-caps bold 20px microsoft yahei","small-caps normal 25px arial","34px microsoft yahei"],n=[],r=Math.floor(parseInt(this.setSize.img_width)/(parseInt(this.options.defaultNum)+1)),a=Math.floor(5*Math.random()),m=1;m<=this.options.defaultNum;m++){n[m-1]=this.getChars("天地玄黄宇宙洪荒日月盈昃辰宿列张寒来暑往秋收冬藏闰余成岁律吕调阳云腾致雨露结为霜金生丽水玉出昆冈剑号巨阙珠称夜光果珍李柰菜重芥姜海咸河淡鳞潜羽翔龙师火帝鸟官人皇始制文字乃服衣裳推位让国有虞陶唐吊民伐罪周发殷汤坐朝问道垂拱平章爱育黎首臣伏戎羌遐迩体率宾归王",n),e=Math.floor(3*Math.random()),s.font=h[e],s.fillStyle=f[a],o=1==Math.floor(2*Math.random())?Math.floor(parseInt(this.setSize.img_height)/2)+20*e+20:Math.floor(parseInt(this.setSize.img_height)/2)-20*e,s.fillText(n[m-1],r*m,o),this.fontPos[m-1]={char:n[m-1],x:r*m,y:o}}for(m=0;m<this.options.defaultNum-this.options.checkNum;m++)this.shuffle(this.fontPos).pop();for(var c="",m=0;m<this.fontPos.length;m++)c+=this.fontPos[m].char+",";return this.htmlDoms.msg.text("请顺序点击【"+c.substring(0,c.length-1)+"】"),this.fontPos},getMousePos:function(t,i){var s=i||a.event;e.documentElement.scrollLeft||e.body.scrollLeft,e.documentElement.scrollTop||e.body.scrollTop;return{x:s.clientX-(r(t).offset().left-r(a).scrollLeft()),y:s.clientY-(r(t).offset().top-r(a).scrollTop())}},getChars:function(t,i){var s=parseInt(Math.floor(Math.random()*t.length));return 0<s&&--s,tmp_char=t.charAt(s),-1==r.inArray(tmp_char,i)?tmp_char:h.prototype.getChars(t,i)},shuffle:function(t){for(var i,s,e=t.length;e;)i=Math.random()*e-- >>>0,s=t[e],t[e]=t[i],t[i]=s;return t},createPoint:function(t){return this.htmlDoms.img_panel.append('<div class="point-area" style="background-color:#1abd6c;color:#fff;z-index:9999;width:30px;height:30px;text-align:center;line-height:30px;border-radius: 50%;position:absolute;top:'+parseInt(t.y-10)+"px;left:"+parseInt(t.x-10)+'px;">'+this.num+"</div>"),++this.num},comparePos:function(t,i){for(var s=!0,e=0;e<t.length;e++)if(!(parseInt(i[e].x)+40>t[e].x&&parseInt(i[e].x)-40<t[e].x&&parseInt(i[e].y)+40>t[e].y&&parseInt(i[e].y)-40<t[e].y)){s=!1;break}return s},showImg:function(){this.htmlDoms.out_panel.css({display:"block"})},hideImg:function(){this.htmlDoms.out_panel.css({display:"none"})},refresh:function(){var i=this;this.$element.find(".point-area").remove(),this.fontPos=[],this.checkPosArr=[],this.num=1,this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var t=new Image;t.src=this.options.imgUrl+this.options.imgName[this.img_rand],r(t).on("load",function(t){this.fontPos=i.drawImg(i,this)}),i.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"}),i.$element.find(".verify-msg").text("验证失败"),i.$element.find(".verify-refresh").show()}},r.fn.codeVerify=function(t,i){new s(this,t).init()},r.fn.slideVerify=function(t,i){new o(this,t).init()},r.fn.pointsVerify=function(t,i){new h(this,t).init()}}(jQuery,window,document);